<!-- src/main/resources/templates/events.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="fragments/layout :: layout(~{::body}, 'DFC Hangul - Events', 'events')">
  <body>
    <!-- Upcoming Events -->
 <section class="section">
  <h2 th:text="${tokTitle}">Taste of Korea — Event Highlights</h2>
  <p class="subtitle" th:text="${tokSubtitle}">Thanks…</p>

  <div class="tok-gallery" th:if="${!#lists.isEmpty(tokGallery)}">
    <figure class="tok-item" th:each="g : ${tokGallery}">
      <img class="tok-thumb"
           th:src="${g['src']}" th:alt="${g['alt']}" loading="lazy" />
      <figcaption th:text="${g['caption']}">Caption</figcaption>
    </figure>
  </div>

  <div class="card" th:if="${#lists.isEmpty(tokGallery)}">
    <p class="muted">Photos coming soon.</p>
  </div>
</section>


    <!-- Lightbox -->
   
    <script>
      let thumbs = [];
      let current = 0;

      function collectThumbs() {
        thumbs = Array.from(document.querySelectorAll('.gallery-thumb'))
          .map((el, idx) => ({
            src: el.getAttribute('data-src') || el.src,
            alt: el.getAttribute('alt') || '',
            caption: el.closest('figure')?.querySelector('figcaption')?.textContent?.trim() || '',
            index: idx
          }));
      }

      function openLightbox(ev) {
        if (!thumbs.length) collectThumbs();
        const el = ev.currentTarget;
        const src = el.getAttribute('data-src') || el.src;
        current = thumbs.findIndex(t => t.src === src);
        if (current < 0) current = 0;
        renderLightbox();
        const lb = document.getElementById('lb');
        lb.classList.add('show');
        lb.setAttribute('aria-hidden', 'false');
        document.body.style.overflow = 'hidden';
      }

      function closeLightbox() {
        const lb = document.getElementById('lb');
        lb.classList.remove('show');
        lb.setAttribute('aria-hidden', 'true');
        document.body.style.overflow = '';
      }

      function navLightbox(step) {
        if (!thumbs.length) return;
        current = (current + step + thumbs.length) % thumbs.length;
        renderLightbox();
      }

      function renderLightbox() {
        const t = thumbs[current];
        const img = document.getElementById('lb-img');
        const cap = document.getElementById('lb-caption');
        img.src = t.src;
        img.alt = t.alt || 'Event photo';
        cap.textContent = t.caption || '';
      }

      document.addEventListener('click', function (e) {
        const lb = document.getElementById('lb');
        if (!lb.classList.contains('show')) return;
        if (e.target === lb) closeLightbox();
      });
      document.addEventListener('keydown', function (e) {
        const lbShown = document.getElementById('lb').classList.contains('show');
        if (!lbShown) return;
        if (e.key === 'Escape') closeLightbox();
        if (e.key === 'ArrowRight') navLightbox(1);
        if (e.key === 'ArrowLeft')  navLightbox(-1);
      });
    </script>
  </body>
</html>
